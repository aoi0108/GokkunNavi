<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ごっくんナビ</title>
    <link rel="stylesheet" href="style.css" />
    <script src="https://cdn.jsdelivr.net/npm/p5@1.11.4/lib/p5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.11.4/lib/addons/p5.sound.min.js"></script>
    <script src="https://p5play.org/v3/planck.min.js"></script>
    <script src="https://p5play.org/v3/p5play.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
  </head>
  <body>
    <div class="container">
      <div id="menuView" class="view">
        <h1>ごっくんナビ</h1>
        <p>
          このゲーム集は、服薬時の嚥下を苦手とする人のために開発されたものです。<br />
          手元に薬と水を用意してゲームを始めてください。
        </p>
        <div class="menu-buttons">
          <div id="btnCheer" class="game-card">
            <h3>お疲れ！乾杯ゲーム</h3>
            <p>
              「せーの」のタイミングでお薬を飲んで、みんなで楽しく乾杯しましょう！笑顔で飲めば成功です。
            </p>
          </div>
          <div id="btnWorld" class="game-card">
            <h3>世界滅亡の危機を救え！</h3>
            <p>
              世界の運命があなたの手に！勇気を出してお薬を飲み、世界の危機を救いましょう。
            </p>
          </div>
          <div id="btnBattle" class="game-card">
            <h3>バトルゲーム</h3>
            <p>
              HPがなくなる前にお薬を飲み、口を開けて強力な氷の攻撃で敵を倒しましょう！
            </p>
          </div>
        </div>
      </div>

      <!-- チュートリアル -->
      <div id="tutorial" class="tutorial-overlay" style="display: none">
        <div class="tutorial-content">
          <h3>遊び方</h3>
          <div class="tutorial-step">
            <img src="assets/tutorial-camera.png" alt="カメラ許可" />
            <p>
              1. カメラの使用を許可してください<br />（顔の認識に使用します）
            </p>
          </div>
          <div class="tutorial-step">
            <img src="assets/tutorial-prepare.png" alt="準備" />
            <p>2. お薬と水を手元に用意します</p>
          </div>
          <div class="tutorial-step">
            <img src="assets/tutorial-open.png" alt="口を開ける" />
            <p>3. お薬を飲んだら、0.5秒以上口を開けます</p>
          </div>
          <button id="closeTutorial">理解しました</button>
        </div>
      </div>

      <div id="cheersView" class="view" style="display: none">
        <h2>お疲れ！乾杯ゲーム</h2>
        <div class="character-container">
          <img id="salaryman" src="assets/salaryman.png" alt="サラリーマン" />
          <div class="speech-bubble">
            <div id="cheersMessage">準備中...</div>
            <div id="cheersCountdown" class="countdown" style="display: none">
              3
            </div>
            <div id="cheersResult" style="display: none">
              <h2>クリア！</h2>
              <p>お疲れ様でした！</p>
            </div>
          </div>
        </div>
        <video
          id="izakayaVideo"
          src="assets/izakaya2.mp4"
          style="display: none; width: 100%"
        ></video>
        <div class="media-placeholder"></div>
        <div class="button-container">
          <button id="cheersStartButton">スタート</button>
          <button id="cheersRestartButton" style="display: none">
            もう一度プレイ
          </button>
          <button class="backToMenu">メニューに戻る</button>
        </div>
      </div>

      <div id="worldView" class="view" style="display: none">
        <h2>世界滅亡の危機を救え！</h2>
        <video
          id="intro-video"
          src="assets/lastbossmovie2.mp4"
          playsinline
          style="display: none; width: 100%"
        ></video>
        <div class="world-top">
          <img
            id="bossImage"
            src="assets/lastboss.png"
            alt="boss"
            class="boss-image"
          />
          <div class="speech-bubble">
            <div id="worldMessage">
              薬を飲む準備ができたら、スタートボタンを押すんだ。
            </div>
            <div id="worldCountdown" class="countdown" style="display: none">
              3
            </div>
            <div id="worldResult" style="display: none">
              <h2>成功！</h2>
              <p>世界は救われた！</p>
            </div>
          </div>
        </div>
        <div class="media-placeholder"></div>
        <div class="button-container">
          <button id="worldStartButton">スタート</button>
          <button id="worldRestartButton" style="display: none">
            もう一度
          </button>
          <button class="backToMenu">メニューに戻る</button>
        </div>
      </div>

      <div id="battleView" class="view" style="display: none">
        <h2>バトルゲーム</h2>
        <video
          id="battle-video"
          src="assets/fireboss2.mp4"
          playsinline
          style="display: none; width: 100%"
        ></video>
        <div class="battle-area">
          <div class="hp-bars">
            <div class="enemy-hp">
              <div class="hp-label">敵のHP</div>
              <div id="enemyHPBar" class="hp-bar">
                <div id="enemyHPFill" class="hp-fill"></div>
              </div>
            </div>
            <div class="player-hp">
              <div class="hp-label">あなたのHP</div>
              <div id="playerHPBar" class="hp-bar">
                <div id="playerHPFill" class="hp-fill"></div>
              </div>
            </div>
          </div>
          <div class="battle-field">
            <div class="boss-container">
              <img
                id="battleBoss"
                src="assets/boss.png"
                alt="boss"
                class="boss-image"
              />
            </div>
            <div class="media-placeholder"></div>
          </div>
          <p id="battleMessage" class="battle-message">
            薬を飲めたら口を開けて氷攻撃を仕掛けよう！
          </p>
        </div>
        <div class="button-container battle-buttons">
          <button id="battleStartButton">スタート</button>
          <button id="battleRestartButton" style="display: none">
            もう一度
          </button>
          <button class="backToMenu">メニューに戻る</button>
        </div>
      </div>

      <div id="mediaContainer" style="display: none">
        <video id="video" autoplay muted playsinline></video>
        <canvas id="canvas"></canvas>
      </div>
    </div>
    <script src="sketch.js"></script>
  </body>
</html>
