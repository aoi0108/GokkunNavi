<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ごっくんナビ</title>
    <link rel="stylesheet" href="style.css" />
    <script src="https://cdn.jsdelivr.net/npm/p5@1.11.4/lib/p5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.11.4/lib/addons/p5.sound.min.js"></script>
    <script src="https://p5play.org/v3/planck.min.js"></script>
    <script src="https://p5play.org/v3/p5play.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
    <!-- PWA for iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="apple-mobile-web-app-title" content="GokkunNavi" />
    <link rel="apple-touch-icon" href="assets/icon.png" />
    <!-- PWA for android -->
    <link rel="manifest" href="manifest.json" />
    <link rel="icon" href="assets/icon.png" />
  </head>
  <body>
    <video
      id="bg-video"
      src="assets/background.mp4"
      autoplay
      loop
      muted
      playsinline
    ></video>
    <div class="container">
      <div id="menuView" class="view">
        <h1>ごっくんナビ</h1>
        <p>
          このゲーム集は、服薬時の嚥下を苦手とする人のために開発されたものです。<br />
          手元に薬と水を用意してゲームを始めてください。
        </p>
        <div class="menu-buttons">
          <div id="btnCheer" class="game-card">
            <img
              src="assets/salaryman.png"
              alt="乾杯ゲーム"
              class="game-icon"
            />
            <div class="game-card-content">
              <h3>お疲れ！乾杯ゲーム</h3>
              <p>
                乾杯のタイミングでお薬を飲んで、みんなで楽しく盛り上がりましょう！笑顔で飲めば成功です。
              </p>
            </div>
          </div>
          <div id="btnWorld" class="game-card">
            <img src="assets/lastboss.png" alt="世界滅亡" class="game-icon" />
            <div class="game-card-content">
              <h3>世界滅亡の危機を救え！</h3>
              <p>
                世界の運命があなたの手に！勇気を出してお薬を飲み、世界の危機を救いましょう。
              </p>
            </div>
          </div>
          <div id="btnRomeoJuliet" class="game-card">
            <img
              src="assets/romjulie.png"
              alt="ロミジュリゲーム"
              class="game-icon"
            />
            <div class="game-card-content">
              <h3>ロミジュリゲーム</h3>
              <p>
                禁じられた愛の果てに、彼女はひとつの決断を下す。――これは、愛と勇気が試されるジュリエットの物語。
              </p>
            </div>
          </div>
          <div id="btnBattle" class="game-card">
            <img src="assets/boss.png" alt="バトル" class="game-icon" />
            <div class="game-card-content">
              <h3>バトルゲーム</h3>
              <p>
                HPがなくなる前にお薬を飲み、口を開けて強力な氷の攻撃で敵を倒しましょう！
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- チュートリアル -->
      <div id="tutorial" class="tutorial-overlay" style="display: none">
        <div class="tutorial-content">
          <h3>遊び方</h3>
          <div class="tutorial-step">
            <img src="assets/tutorial-camera.png" alt="カメラ許可" />
            <p>1. カメラの使用を許可してください（顔の認識に使用します）</p>
          </div>
          <div class="tutorial-step">
            <img src="assets/tutorial-prepare.png" alt="準備" />
            <p>2. お薬と水を手元に用意します</p>
          </div>
          <div class="tutorial-step">
            <img src="assets/tutorial-select.png" alt="ゲーム選択" />
            <p>3. 好きなゲームを選択します</p>
          </div>
          <div class="tutorial-step">
            <img src="assets/tutorial-open.png" alt="口を開ける" />
            <p>4. ゲームの説明に従い、お薬を飲んだ後は口を開けます</p>
          </div>
          <button id="closeTutorial">理解しました</button>
        </div>
      </div>

      <div id="cheersView" class="view" style="display: none">
        <h2>お疲れ！乾杯ゲーム</h2>
        <div class="character-container">
          <img id="salaryman" src="assets/salaryman.png" alt="サラリーマン" />
          <div class="speech-bubble">
            <div id="cheersMessage">準備中...</div>
            <div id="cheersCountdown" class="countdown" style="display: none">
              3
            </div>
            <div id="cheersResult" style="display: none">
              <h2>クリア！</h2>
              <p>お疲れ様でした！</p>
            </div>
          </div>
        </div>
        <video
          id="izakayaVideo"
          src="assets/izakaya.mp4"
          style="display: none; width: 100%"
        ></video>
        <div class="media-placeholder"></div>
        <div class="button-container">
          <button id="cheersStartButton">スタート</button>
          <button id="cheersRestartButton" style="display: none">
            もう一度!
          </button>
          <button class="backToMenu">メニューに戻る</button>
        </div>
      </div>

      <div id="worldView" class="view" style="display: none">
        <h2>世界滅亡の危機を救え！</h2>
        <video
          id="intro-video"
          src="assets/lastboss.mp4"
          playsinline
          style="display: none; width: 100%"
        ></video>
        <div class="world-top">
          <img
            id="bossImage"
            src="assets/king.png"
            alt="boss"
            class="boss-image"
          />
          <div class="speech-bubble">
            <div id="worldMessage">
              薬を飲む準備ができたら、スタートボタンを押すんだ。
            </div>
            <div id="worldCountdown" class="countdown" style="display: none">
              3
            </div>
            <div id="worldResult" style="display: none">
              <h2>成功！</h2>
              <p>世界は救われた！</p>
            </div>
          </div>
        </div>
        <div class="media-placeholder"></div>
        <div class="button-container">
          <button id="worldStartButton">スタート</button>
          <button id="worldRestartButton" style="display: none">
            もう一度！
          </button>
          <button class="backToMenu">メニューに戻る</button>
        </div>
      </div>

      <div id="romeoJulietView" class="view" style="display: none">
        <h2>ロミジュリゲーム</h2>
        <video
          id="romeoJuliet-video"
          src="assets/romjulie.mp4"
          playsinline
          style="display: none; width: 100%"
        ></video>
        <div class="world-top">
          <img
            id="julietImage"
            src="assets/romjulie.png"
            alt="juliet"
            class="boss-image"
          />
          <div class="speech-bubble">
            <div id="romeoJulietMessage">
              あなたはジュリエット。愛するロミオと密かに結婚したものの、家の争いにより、別の男性との結婚を命じられています。逃れるための唯一の道は――神父が差し出した“仮死の薬”を飲むこと。42時間の眠りにつけば、再びロミオと会えるはず。手元に水を用意し、深呼吸してください。これは、愛を信じる最後の選択です。
            </div>
            <div
              id="romeoJulietCountdown"
              class="countdown"
              style="display: none"
            >
              5
            </div>
            <div id="romeoJulietResult" style="display: none">
              <h2>成功！</h2>
              <p>
                あなたは静かに眠りについた。だが、ロミオはその真実を知らぬまま、あなたの眠る傍らで命を絶った――。その夜、二人の愛は永遠となった。
              </p>
            </div>
          </div>
        </div>
        <div class="media-placeholder"></div>
        <div class="button-container">
          <button id="romeoJulietStartButton">スタート</button>
          <button id="romeoJulietRestartButton" style="display: none">
            もう一度！
          </button>
          <button class="backToMenu">メニューに戻る</button>
        </div>
      </div>

      <div id="battleView" class="view" style="display: none">
        <h2>バトルゲーム</h2>
        <video
          id="battle-video"
          src="assets/fireboss2.mp4"
          playsinline
          style="display: none; width: 100%"
        ></video>
        <div class="battle-area">
          <div class="hp-bars">
            <div class="enemy-hp">
              <div class="hp-label">敵のHP</div>
              <div id="enemyHPBar" class="hp-bar">
                <div id="enemyHPFill" class="hp-fill"></div>
              </div>
            </div>
            <div class="player-hp">
              <div class="hp-label">あなたのHP</div>
              <div id="playerHPBar" class="hp-bar">
                <div id="playerHPFill" class="hp-fill"></div>
              </div>
            </div>
          </div>
          <div class="battle-field">
            <div class="boss-container">
              <img
                id="battleBoss"
                src="assets/boss.png"
                alt="boss"
                class="boss-image"
              />
            </div>
            <div class="media-placeholder"></div>
          </div>
          <div id="battleMessage" class="battle-message">
            手元に薬と水を用意してスタートボタンを押そう！
          </div>
          <div
            id="battleCountdown"
            class="countdown"
            style="display: none"
          ></div>
        </div>
        <div class="button-container battle-buttons">
          <button id="battleStartButton">スタート</button>
          <button id="battleRestartButton" style="display: none">
            もう一度!
          </button>
          <button class="backToMenu">メニューに戻る</button>
        </div>
      </div>

      <!-- After-story videos -->
      <video
        id="izakayaAfterVideo"
        src="assets/izakaya-after.mp4"
        playsinline
        style="display: none; width: 100%"
      ></video>
      <video
        id="worldAfterVideo"
        src="assets/lastboss-after.mp4"
        playsinline
        style="display: none; width: 100%"
      ></video>
      <video
        id="romeoJulietAfterVideo"
        src="assets/romjulie-after.mp4"
        playsinline
        style="display: none; width: 100%"
      ></video>

      <div id="mediaContainer" style="display: none">
        <video id="video" autoplay muted playsinline></video>
        <canvas id="canvas"></canvas>
      </div>
    </div>
    <script src="sketch.js"></script>
  </body>
</html>
